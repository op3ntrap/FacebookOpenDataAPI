
# coding: utf-8

# In[1]:

import requests

'''
client_id = "d1d309f7e7f14b8cb8533ba1bcb84535"
client_secret = "66c423d2d2dc4634adbfe7c26211fb60"
redirect_uri = "http://www.snifferapp.in"
scope = "likes+comments+follower_list+basic+public_content"
url = "https://api.instagram.com/oauth/authorize/?client_id="+client_id+"&scope"+scope+"&redirect_uri="+redirect_uri+"&response_type=code"
print url
#code = "c8bedbab59724834940bca3faffc4158"
def prettify(json_data):
    print json.dumps(json_data, sort_keys=True, indent=4)

'''
# In[2]:

#code = "7447f7a936d74eb185e4265d72734b00"
#r = requests.post('https://api.instagram.com/oauth/access_token', data = {'client_id':client_id,'client_secret': client_secret ,'grant_type' : 'authorization_code','redirect_uri':redirect_uri,'code':code})


# In[3]:

#data = r.json()
#access_token = data['access_token']
#print access_token
access_token1= "3407738697.e029fea.8659525c7ca248f3b3fd6eb1130771e1"
access_token2= "3407738697.1677ed0.aaf2960399d8426383cdcc2372962353"
access_token3= "3407738697.1677ed0.aaf2960399d8426383cdcc2372962353"
access_token4= "3407738697.d90570a.0e8a1e4340084d18a9e0f48a7366a803"


# In[18]:

import json
def get_recent_media(location_id):
    images_list = []
    i = 2
    try:
        images = requests.get("https://api.instagram.com/v1/locations/"+location_id+"/media/recent?limit=500&access_token="+access_token1)
        data = images.json()
        for values in data['data']:
            images_list.append(values)
    except KeyError:
        return images_list
    #############################################################
    while(i<5):
        #images = requests.get("https://api.instagram.com/v1/locations/"+location_id+"/media/recent?access_token="+access_token1)
        try:
            images = requests.get(data['pagination']['next_url'])
            
            time.sleep(7)
        
            data = images.json()
            #print data['pagination']['next_url']
        except KeyError:
            return images_list
       
        if (len(data['data']) == 0):
            break
        
        for values in data['data']:
            images_list.append(values)
        #print len(images_list)
    ##############################################################
    return images_list
        
    
        
#data = get_recent_media("1596228673925550")


# In[ ]:

import time
from pymongo import MongoClient


'''


    
i=0
for record in places_in_db:
    try:
        r = db['instagram_buzz'].find_one({"id" : str(record['id'])})
        if (r != None or (str(record['id'])== "529533190459519")):
            #print "continuing"
            continue
        while(i<1):
            continue
        i+=1
        buzz = get_recent_media(str(record['id']))
    except KeyError:
        continue
    entry = {
        "id" : record['id'],
        "buzz" : buzz
    }
    instagram_buzz.insert_one(entry)
    


# In[ ]:

#print len(images_list)


# In[28]:

#print images
#r = db['instagram_buzz'].find_one({"id" : "438897572912sef995"})
#print r


# In[ ]:

#def get_location_info(location_id):
    #ocation_info = requests.get("https://api.instagram.com/v1/locations/"+location_id+"?access_token="+access_token)
    #data = location_info.json()
    #return data


# In[ ]:

#print get_location_info("268241859")


# In[ ]:

def get_media_id(shortcode):
    media_info = requests.get("https://api.instagram.com/v1/media/shortcode/"+shortcode+"?access_token="+access_token1)
    data = media_info.json()
    return data
import json
data =  get_media_id("BAT-hBIQl3_")
def prettify(json_data):
    print json.dumps(json_data, sort_keys=True, indent=4)


# In[ ]:

media_id =  data['data']['id']
print media_id


# In[ ]:

import requests
def like_media(media_id):
    data = requests.post("https://api.instagram.com/v1/media/"+media_id+"/likes",data={'access_token': access_token1})
    print data.content


# In[ ]:

like_media("1305883040178690375_465361750")


# In[ ]:

data = requests.get("https://api.instagram.com/v1/media/"+media_id")

'''

client = MongoClient()
db = client.db
#places_in_db = db['fb_locations_info'].find()
instagram_buzz = db['instagram_buzz']

places_id = ['802093909869354', '377884565737201', '712304192173540', '1526042347635790', '477103419126059', '438897572912995', '457345074398219', '1483712835208368', '1596228673925550', '452629504888531', '749703958393775', '1495056677403554', '852682064747109', '918476224875669', '694419810655162', '595110083848155', '877258765687427', '612628865435687', '553903048073803', '804424742913967', '947255065340978', '500551953376292', '1621689538087429', '771705636277342', '1413735865558009', '275426039333511', '744874935592195', '646707992087283', '1624531417759395', '688997097855112', '1464188823816652', '1626777457584682', '214619838736829', '1545521725765135', '981940755165310', '139909776116348', '183786825302829', '1511110395771983', '1615709118698040', '771417569606687', '688976784570940', '470363416398575', '1505422189701143', '785469201569924', '263571253670186', '743281982406843', '1741898922700866', '622597514471749', '742877935745918', '687537101390703', '622491477806981', '643153305793583', '1655917471321956', '615033095208263', '287964828060727', '337636433006030', '150613881811568', '520732501345138', '1669157569985571', '563452663740419', '382465448554914', '144344912569580', '215427191983745', '455869717947332', '651052844979990', '1468532553471108', '467180350152255', '257062384494787', '441260545995259', '338220352981617', '368245456717599', '149494245411374', '842478659160069', '108424502651351', '117127505003333', '541631232625499', '1580739805523899', '1438807886344698', '210912659091567', '210560595745617', '520483204751287', '582176338595228', '529533190459519', '225038861162766', '312798422157938', '465448270320128', '1569085870026036', '1546444669006777', '228299593944150', '888212964569527', '903285753047070', '433593550184970', '137166182994451', '1660970577466065', '426066150799052', '1768356446637252', '515504078567641', '243438079016503', '201198136711792', '121102714732638', '395456647225475', '426258010816642', '142778025798441', '153432921431180', '240002469842', '219965084730582', '269042973267284', '559610537461116', '1611727472408045', '21167688463', '1060747240632889', '426612120762727', '868408879879746', '353705774651852', '44267709042', '212891115463960', '667594473255944', '265927753753456', '930871170324141', '1698404967052536', '531075606920535', '467667233418495', '158824174144911', '275527969223093', '235980296734147', '427119620713181', '244466595688149', '652672528088210', '397313247136445', '226781547526237', '445096538909106', '455522821248944', '983745381649455', '146931255367665', '288416037986342', '220015834681409', '235316466616577', '1043138735710666', '399089926804997', '114874001917456', '731733603629842', '109288969404482', '429539495634', '895097323942702', '90121763035', '1612545852300397', '721172594560593', '541039955977965', '134225373319252', '134510720287592', '318591034953667', '437507106455334', '290649584281285', '301624706697683', '333128203453183', '1556007254699611', '522174401247592', '114941415213110', '430796800342863', '1540635486163901', '166605656835990', '323431034456066', '22381842827', '1620387864878585', '453722864643921', '228181514049809', '393116107460208', '426318577402272', '617711854972379', '926966354077371', '992006247528065', '371787752923426', '499917976857463', '816803648341790', '133943930009742', '440417899473305', '725990880838072', '245248908979842', '1653836121528773', '175232975985479', '237197379665375', '360131617347227', '1404250706567467', '680618182078273', '759294754124266', '411289845638344', '122795647742799', '619249381452486', '933079616717215', '1457774061217048', '160114104071261', '353312634834680', '473862042738878', '469710166418103', '146568638836831', '360217350854195', '196473803855917', '1625993324327489', '464244267114893', '918722288144571', '1148997355113123', '298681556923970', '518602494955952', '180272105348224', '539226746126488', '143098842373335', '222071434350', '932616163489746', '321153261239462', '300314793426935', '275281495952355', '430827783678040', '172415379579469', '158047374385435', '826258357452277', '673331836122164', '1680856775464619', '537243459639237', '642761692434614', '1695750180647249', '579550822095433', '1631352040426632', '290115777665686', '1432660367027837', '567098763322537', '754091634627201', '928943943819527', '204950999665602', '172607342863471', '918213198196308', '601571676534683', '177416465406', '489591307912410', '220472311468175', '305688092835353', '699622530168503', '422618871184603', '1441696616137606', '143969065788086', '371345739709307', '923867521021648', '399566216877694', '143528002519741', '187059054680902', '339572142914377', '1505221009774852', '240675535974027', '607097872703328', '301535986554189', '1440042499559018', '988213674535350', '925558917525093', '926037297453019', '874584022576454', '977500035607539', '471446093054603', '1466061570295293', '137481793115859', '760455240689631', '163138014032251', '334020406660436', '857702787581169', '168978850131059', '250623201789476', '169462009757421', '120557698025027', '235854113110772', '100280113507629', '620300954692967', '387529074604770', '533178043387673', '208933939280783', '768885239791197', '1667183306901401', '194164154075785', '256711371204053', '420976151434833', '109749392531785', '183499115177330', '1099357753428748', '1429322190701998', '345373838992335', '962076433843348', '165404700286541', '196309334044635', '133735583492537', '1377721005807152', '1415516722025636', '1413880558856858', '224965857515458', '250118271825844', '1719813894929576', '1480274105622475', '647248681966215', '1728218920736048', '641847882524734', '423945674405684', '495789700580363', '252435911587179', '938455379606219', '1669172490022426', '880696122048139', '1605068846389316', '741082096003560', '818221774973726', '1013580975349162', '178071715893137', '960158444041196', '213053628866532', '1539634716326758', '397028610403491', '217806678231874', '372061696220857', '382051071962826', '660014957464659', '436338663158548', '380654458812003', '1005641822792864', '1403739343271472', '231007140600443', '182461985269488', '836218706444643', '481296475374810', '440778209312584', '748087328623379', '124938777567596', '1401965783375380', '892516377522072', '156258261112031', '301403306864193', '475211662586920', '826657644078721', '347373452116992', '256496584402986', '1636307536655816', '272890619526450', '357575244383556', '146304842213599', '383633048340786', '1396179707350101', '793232420765900', '281705618670124', '115612645224687', '516726948340648', '1981577345399705', '132824380127724', '249777248478861', '516215815225821', '471335369737904', '542197922607810', '755113814591626', '232022483630660', '185189245185090', '144395735588573', '671733552916086', '559123964124858', '144475362339836', '1638948732996548', '192985190742005', '1543372022559506', '718477034918026', '621957491291259', '1525805714340844', '641998119278000', '179351202446178', '256264004744318', '796530683797488', '434116820114839', '1626276307688967', '302488736623317', '888016121252128', '716341571740833', '482736245234109', '843993035637113', '1461259957498639', '758987804146454', '515811061919783', '467478320084928', '312930292223934', '443368595791889', '552475281579675', '476441299118553', '1508329182793825', '737853699637734', '244762649012050', '1410129572612579', '1694929570788211', '1713354502212712', '172713879789378', '1624209924570641', '529263737223612', '627402014068251', '349698915133925', '128411417357393', '601370539973031', '1658506521052712', '302795353259671', '1493918687496803', '307827976015656', '611039599074759', '306371252805150', '485899068222531', '260640550758667', '914388268681196', '273611312800869', '471511219650349', '710988048921891', '218635494979046', '948088955281521', '512782985559427', '589593987847896', '627270864027833', '489034434585861', '127509330772799', '1523980017856478', '550589505075130', '177197525816363', '868716756516306', '704018376295507', '500698550027560', '789213744540342', '1530448117212513', '609930169113824', '333519486839425', '318306741573479', '1611492432514005', '834127649998493', '1655475911330720', '149171385437616', '345873328837798', '1641896959416417', '1563560973918306', '308481459341400', '1023900947704869', '777129029016381', '778091115599779', '1009882802384175', '788741287924386', '381884941992777', '1040046386017612', '322445744588591', '233485970104647', '1439602726265828', '509949162406843', '554641141357842', '496599137074454', '362376930548210', '113917585428447', '204760299650408', '223203848034017', '410916015778089', '294538504050914', '205529826179674', '911243425585123', '627110220645727', '246779272197169', '444928085706110', '922909054451322', '135869093483494', '125936244478991', '545011099013050', '952144244801882', '1392034224381949', '244330949258852', '1607494576179829', '170586219997482', '1718339565099847', '1677521505853756', '459919217505216', '452878834826949', '922983807740909', '511582948855909', '690396807694712', '237682709762611', '638767716174955', '436658963137748', '595098470624582', '1659184720992990', '1012961415459731', '213768945623243', '161163020926653', '1689340997945859', '405541086301283', '879018978836611', '809277035804853', '718622611608175', '124202177998930', '675411179216435', '285746978482265', '510491125665269', '287327598144997', '599491410136616', '178469625885153', '1534766803470367', '763836280294440', '417768995100987', '266853343666322', '232082610297424', '524803737637626', '425880400828537', '751210528227674', '372473386172201', '208627362559949', '269621193113651', '1508930089404456', '1723468901205843', '964222103639215', '1497612593868240', '506633622873325', '1695934867352790', '1133475040053124', '820574301321517', '508096289392159', '507534416014925', '1447527468606167', '925624197531193', '466449196878963', '114906495591573', '754330261366021', '1323555647672067', '563326197098996', '710325868980274', '264552573681892', '155429104876018', '1724825617793352', '165418416947926', '701817123255513', '303212783045726', '1088040921247460', '1401733020081374', '1502365720067853', '792354254135414', '594444677320297', '1695455520722893', '116699575164666', '199287463588624', '524335160993508', '1415144608794393', '1411003762468927', '1007229925956422', '440052529407795', '150880001592006', '484918914992869', '201445529892035', '581781048555065', '819575968126704', '350784861770325', '254736311366749', '990187957764322', '1013739515378736', '1709040342679379', '142024839153920', '889790037711914', '857853414306771', '582033961899681', '844241848970281', '471169989687730', '1634497276809256', '1548092895435818', '917596128280344', '346112705535894', '429532370566993', '1520936501496380', '332856566851585', '601996386521497', '679976595457677', '498564550235264', '864043510285692', '830529043705538', '405665899538861', '189221951237707', '190625887641560', '1552540318321613', '405690992833240', '632142153594785', '219475821572940', '933574526702426', '187017944797944', '1534248433469816', '469531179811726', '637037556348422', '1525855024304251', '186785738336800', '1097226576963943', '670357979743256', '292862807507696', '118332131560994', '373390529500481', '1461082380886992', '546147602167086', '903057503056362', '128966795872', '183298888374109', '1649012438714610', '1577971399081432', '708053659224124', '186249831447686', '855808414502601', '644856012271886', '172121972898300', '276806569161337', '313781078785417', '284902024979097', '1626833987567070', '469487769829975', '540367042783463', '323122801127769', '651054401658163', '255621927970900', '95335595024', '424962710994156', '609647955859359', '637527923067277', '470984119646695', '1534944460100700', '107738449310148', '720949354599411', '615766275195035', '647651548719518', '897683160243440', '1627977520807232', '608249355978275', '125809947616326', '782068755208986', '1410239549259193', '297509323631109', '159714390765878', '1573133282950276', '1467316423584422', '284205675037091', '187493404651690', '792824407455637', '1381514082142437', '366366906821559', '1457820947817443', '1520199471636049', '1549768071937508', '527711850710522', '679033945491095', '1432495027010793', '211575385633127', '777515715635958', '902098533245763', '126768084708', '164233237115619', '1502189406705746', '1698299427051997', '733036993431217', '464871337028101', '560888583927856', '560610047426488', '1056153927744348', '554761697968882', '940092076051294', '559377210800517', '400190553519227', '297235823806110', '180563228796705', '213468782036159', '500847346751864', '382789525132865', '360056414076091', '658738380875518', '428141517328675', '860660167287423', '778463818904898', '285841394954422', '249946868533129', '1284504624901342', '189203224754138', '953505548017422', '1516414058606563', '875498275899463', '573662369440788', '255884217845901', '343479659190906', '741368855896171', '110884009067772', '487586524750323', '476142425894816', '257756391074379', '119098648446575', '704288392991802', '322824394490033', '568829309965658', '1485356105086337', '311936722167912', '543617422451975', '623319264350033', '898469873517219', '691780324286316', '617120751680413', '826693517396815', '527264944033609', '166522473498680', '200067330359890', '675404159230569', '793242147403827', '1635952536688238', '818228954876613', '997743143637806', '499869046870215', '344270035717173', '440970985979193', '1492385117734285', '465852300184158', '342971849157142', '134884340008200', '673817952718045', '1001542559876206', '740780329362709', '1423836284607128', '913422575422616', '235617133464755', '792837034126990', '291723364337072', '143571615773081', '1404350639857183', '543656782400059', '507773685955402', '1650019671911841', '365014857026737', '275643112782415', '111676468865231', '342714569233412', '241085179611577', '779379438838602', '1676007555952658', '1562274654019375', '682994671784137', '550406848371066', '427928957366427', '1004769692882643', '661347833918880', '620820761369551', '1510419629266561', '307628576021728', '216200411891580', '675051965915939', '555035704582172', '695934527165146', '625451330918934', '883208141750909', '254566898251636', '1563525560631177', '660401677401397', '873773719313714', '1529529897264937', '1192929174072340', '1593519877569396', '277959212249701', '612290032205637', '1383129788606992', '1405064183119358', '1556757124548197', '191962977501890', '1579801965569064', '1514952525415498', '597288523734217', '542388899250266', '174958626025668', '240503252736816', '142322645859130', '340922726028757', '251333434900394', '1526513307661903', '790952591023022', '1094460360600595', '1654253991568118', '962332750516492', '732439233442343', '1023877337636814', '1027568277301330', '1263618660322138', '1606713549608634', '503956386479714', '640378072739970', '423237171068764', '157221947664149', '861610823936689', '425107454331339', '954148357965286', '878252072285574', '236592139746495', '703729543072451', '1232494686778016', '992493084122514', '1031759160216148', '566059023440439', '779108962210114', '1468860323334245', '115083691902967', '175925079423682', '1156346751072293', '721695067877082', '326134107480711', '1070944779632038', '1696322297292092', '353382698046914', '899173890202577', '840228802750583', '458719520994004', '1000876379985555', '468771713326523', '145471848956472', '190401121092350', '178430675632746', '116908044998033', '467531150041823', '1613219312272394', '201240410229127', '533082586787842', '266754366805642', '415003262039931', '869615909760558', '731217596933797', '1425443657764392', '346740758803585', '603058266377162', '1406100489612537', '437762886426205', '191037667573056', '785793494768665', '215413178519492', '219023828109964', '129796803724638', '265241523566193', '140649455965078', '486993181319210', '415577311884205', '512695992242223', '258267394188051', '807604345928051', '436462976562310', '1682243481987086', '831853673575160', '851748304923804', '1477906909143848', '333643523484549', '1225449054143276', '746801098755523', '1513020232337097', '1519051511641913', '1629917863941482', '1693506844210215', '300603166717806', '678078815588484', '891168557622288', '229894767100288', '1635809803359900', '598529176887570', '895935253795981', '275592252550396', '895436553835165', '426533840830776', '302007770008943', '1592126417708273', '1003762236348171', '143585212473914', '502801796527469', '240511315960766', '149389741747553', '1415952225283798', '508575599255341', '225734317496932', '620963344679901', '158486004508478', '503093909786528', '1566787060209373', '104672489876999', '381757201925386', '519864321511362', '352858658207403', '1647694545443514', '382802068504424', '567386780011072', '889805664469106', '255043137917921', '634296229927888', '885325828186325', '528050260641025', '501139989911117', '553227018140758', '1564820107128719', '528462013880236', '808560149203173', '128550880652243', '279684218745462', '368932323205961', '118997708440782', '258037940991702', '1583214781897793', '583944421741296', '147615188597164', '1488010774850772', '250250465005260', '1504264113199950', '151530101934746', '1755751798042781', '589774051181020', '262760130754271', '491163534377352', '783332598411386', '875637469209801', '352324401600884', '107339665952956', '855645134498611', '394160530743356', '158402837594033', '603613729738842', '1512688189014592', '447628431967594', '663267263786508', '816019238417619', '351189431747920', '390729954446605', '1538680289689791', '483956745102346', '422060487940620', '1464511683852553', '959842544113393', '421814637854345', '445041955549277', '1033159916761447', '294970734758', '1722245874683965', '799975690133209', '1601917713431227', '112146572132287', '166168293585834', '487865581331760']

num = 0
while(num<2000):

    for record in places_id:
        if (num < 90):
            num += 1
            continue
        try:
            r =str(record)
            if (r == None or (str(record) == "529533190459519")):
                # print "continuing"
                continue

                #continue

            buzz = get_recent_media(str(record))
        except KeyError:
            continue
        entry = {
            "id": record,
            "buzz": buzz
        }
        instagram_buzz.insert_one(entry)
